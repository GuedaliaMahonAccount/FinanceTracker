<Window x:Class="Finance.ProjectWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Finance"
        xmlns:converters="clr-namespace:Finance.Converters"
        Title="Finance - Projet"
        Height="800"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True">

	<Window.Resources>
		<local:YearConverter x:Key="YearConverter"/>
		<local:TransactionTypeConverter x:Key="TransactionTypeConverter"/>
		<converters:CurrencyDisplayConverter x:Key="CurrencyDisplayConverter"/>
		<SolidColorBrush x:Key="PrimaryColor" Color="#2563EB"/>
		<SolidColorBrush x:Key="AccentColor" Color="#10B981"/>
		<SolidColorBrush x:Key="DangerColor" Color="#EF4444"/>
		<SolidColorBrush x:Key="WarningColor" Color="#F59E0B"/>
		<SolidColorBrush x:Key="CardBackground" Color="#FFFFFF"/>
		<SolidColorBrush x:Key="TextPrimary" Color="#1F2937"/>
		<SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
		<SolidColorBrush x:Key="InputBackground" Color="#F9FAFB"/>
		<SolidColorBrush x:Key="BorderColor" Color="#E5E7EB"/>
	</Window.Resources>

	<Border Background="#F5F7FA" CornerRadius="12" BorderThickness="0">
		<DockPanel>
			<!-- Barre latérale -->
			<Border DockPanel.Dock="Left" Width="250" Background="#FFFFFF" CornerRadius="12,0,0,12"
                    BorderThickness="0,0,1,0" BorderBrush="{StaticResource BorderColor}">
				<local:SideBar />
			</Border>

			<!-- Contenu principal -->
			<Grid Background="#F5F7FA">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
					<StackPanel Margin="40">
						<!-- En-tête -->
						<TextBlock Text="Gestion du Projet" FontSize="32" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimary}" Margin="0,0,0,30"/>

						<!-- Cartes statistiques -->
						<Grid Margin="0,0,0,30">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="20"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="20"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<Border Grid.Column="0" Background="{StaticResource CardBackground}"
                                    CornerRadius="8" Padding="20">
								<StackPanel>
									<TextBlock Text="Total Revenus" FontSize="12"
                                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,8"/>
									<TextBlock FontSize="22" FontWeight="Bold"
                                               Foreground="{StaticResource AccentColor}">
										<Run Text="{Binding TotalIncome, Mode=OneWay, Converter={StaticResource CurrencyDisplayConverter}}" />
									</TextBlock>
								</StackPanel>
							</Border>

							<Border Grid.Column="2" Background="{StaticResource CardBackground}"
                                    CornerRadius="8" Padding="20">
								<StackPanel>
									<TextBlock Text="Total Dépenses" FontSize="12"
                                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,8"/>
									<TextBlock FontSize="22" FontWeight="Bold"
                                               Foreground="{StaticResource DangerColor}">
										<Run Text="{Binding TotalExpenses, Mode=OneWay, Converter={StaticResource CurrencyDisplayConverter}}" />
									</TextBlock>
								</StackPanel>
							</Border>

							<Border Grid.Column="4" Background="{StaticResource CardBackground}"
                                    CornerRadius="8" Padding="20">
								<StackPanel>
									<TextBlock Text="Solde" FontSize="12"
                                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,8"/>
									<TextBlock FontSize="22" FontWeight="Bold"
                                               Foreground="{StaticResource PrimaryColor}">
										<Run Text="{Binding Total, Mode=OneWay, Converter={StaticResource CurrencyDisplayConverter}}" />
									</TextBlock>
								</StackPanel>
							</Border>
						</Grid>

						<!-- Bouton Ajouter Transaction -->
						<Border CornerRadius="6"
                                Width="250"
                                HorizontalAlignment="Left"
                                Margin="0,0,0,30">
							<Button Content="+ Ajouter une Transaction"
                                    Padding="16,12"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Foreground="White"
                                    Background="{StaticResource PrimaryColor}"
                                    BorderThickness="0"
                                    Click="AddTransactionButton_Click"/>
						</Border>

						<!-- Filtres -->
						<Border Background="{StaticResource CardBackground}" CornerRadius="8"
                                Padding="20" Margin="0,0,0,30" BorderThickness="1" BorderBrush="{StaticResource BorderColor}">
							<StackPanel>
								<TextBlock Text="Filtres" FontSize="16" FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimary}" Margin="0,0,0,15"/>

								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="20"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="20"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="20"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Type -->
									<StackPanel Grid.Column="0">
										<TextBlock Text="Type" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
										<Border Background="{StaticResource InputBackground}"
                                                BorderBrush="{StaticResource BorderColor}"
                                                BorderThickness="1"
                                                CornerRadius="4">
											<ComboBox Padding="10,8"
                                                      Background="Transparent"
                                                      BorderThickness="0"
                                                      ItemsSource="{Binding TransactionTypes}"
                                                      SelectedItem="{Binding SelectedTransactionType, Mode=TwoWay}" />
										</Border>
									</StackPanel>

									<!-- Année -->
									<StackPanel Grid.Column="2">
										<TextBlock Text="Année" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
										<Border Background="{StaticResource InputBackground}"
                                                BorderBrush="{StaticResource BorderColor}"
                                                BorderThickness="1"
                                                CornerRadius="4">
											<ComboBox x:Name="YearComboBox"
                                                      Padding="10,8"
                                                      Background="Transparent"
                                                      BorderThickness="0"
                                                      ItemsSource="{Binding AvailableYears}"
                                                      SelectedItem="{Binding SelectedYear, Mode=TwoWay, Converter={StaticResource YearConverter}}"
                                                      SelectionChanged="YearComboBox_SelectionChanged" />
										</Border>
									</StackPanel>

									<!-- Label -->
									<StackPanel Grid.Column="4">
										<TextBlock Text="Label" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
										<Border Background="{StaticResource InputBackground}"
                                                BorderBrush="{StaticResource BorderColor}"
                                                BorderThickness="1"
                                                CornerRadius="4">
											<ComboBox Padding="10,8"
                                                      Background="Transparent"
                                                      BorderThickness="0"
                                                      ItemsSource="{Binding AvailableLabels}"
                                                      SelectedItem="{Binding SelectedLabel, Mode=TwoWay}" />
										</Border>
									</StackPanel>

									<!-- Bouton Réinitialiser -->
									<Border Grid.Column="6"
                                            CornerRadius="4"
                                            VerticalAlignment="Bottom">
										<Button Content="Réinitialiser"
                                                Padding="16,8"
                                                FontSize="12"
                                                Background="#F3F4F6"
                                                Foreground="{StaticResource TextPrimary}"
                                                BorderThickness="0"
                                                Command="{Binding ResetFiltersCommand}" />
									</Border>
								</Grid>
							</StackPanel>
						</Border>

						<!-- Liste des transactions -->
						<TextBlock Text="Transactions" FontSize="16" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimary}" Margin="0,0,0,15"/>

						<ItemsControl ItemsSource="{Binding FilteredTransactions}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Border Background="{StaticResource CardBackground}"
                                            CornerRadius="6"
                                            Padding="16"
                                            Margin="0,0,0,8"
                                            BorderThickness="1"
                                            BorderBrush="{StaticResource BorderColor}">
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="200"/>
												<ColumnDefinition Width="120"/>
												<ColumnDefinition Width="120"/>
												<ColumnDefinition Width="100"/>
												<ColumnDefinition Width="*"/>
												<ColumnDefinition Width="Auto"/>
												<ColumnDefinition Width="Auto"/>
												<ColumnDefinition Width="Auto"/>
											</Grid.ColumnDefinitions>

											<!-- Nom + Label -->
											<StackPanel Grid.Column="0">
												<TextBlock FontSize="13" FontWeight="Bold" Foreground="{StaticResource TextPrimary}">
													<Run Text="{Binding Name}" />
												</TextBlock>
												<TextBlock FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,4,0,0">
													<Run Text="{Binding Label}" />
												</TextBlock>
											</StackPanel>

											<!-- Montant -->
											<TextBlock Grid.Column="1"
                                                       FontSize="13"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource TextPrimary}"
                                                       VerticalAlignment="Center">
												<Run Text="{Binding Amount, StringFormat='{}{0:N2}'}" />
												<Run Text=" " />
												<Run Text="{Binding Currency}" />
											</TextBlock>

											<!-- Date -->
											<TextBlock Grid.Column="2"
                                                       Text="{Binding Date, StringFormat='{}{0:dd/MM/yyyy}'}"
                                                       FontSize="12"
                                                       Foreground="{StaticResource TextSecondary}"
                                                       VerticalAlignment="Center" />

											<!-- Type -->
											<Border Grid.Column="3"
                                                    CornerRadius="4"
                                                    Padding="8,4"
                                                    Background="{Binding IsIncome, Converter={StaticResource TransactionTypeConverter}, ConverterParameter=BackgroundColor}"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Left">
												<TextBlock FontSize="11"
                                                           FontWeight="Bold"
                                                           Foreground="White"
                                                           Text="{Binding IsIncome, Converter={StaticResource TransactionTypeConverter}}" />
											</Border>

											<!-- Espaceur -->
											<Grid Grid.Column="4"/>

											<!-- Boutons -->
											<Border Grid.Column="5" CornerRadius="4" Margin="4,0">
												<Button Content="⬇"
                                                        Padding="8,6"
                                                        FontSize="11"
                                                        Background="#F3F4F6"
                                                        Foreground="{StaticResource TextPrimary}"
                                                        BorderThickness="0"
                                                        Command="{Binding DataContext.DownloadFilesCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                        CommandParameter="{Binding}" />
											</Border>
											<Border Grid.Column="6" CornerRadius="4" Margin="4,0">
												<Button Content="✎"
                                                        Padding="8,6"
                                                        FontSize="11"
                                                        Background="{StaticResource WarningColor}"
                                                        Foreground="White"
                                                        BorderThickness="0"
                                                        Command="{Binding DataContext.EditTransactionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                        CommandParameter="{Binding}" />
											</Border>
											<Border Grid.Column="7" CornerRadius="4" Margin="4,0">
												<Button Content="✕"
                                                        Padding="8,6"
                                                        FontSize="11"
                                                        Background="{StaticResource DangerColor}"
                                                        Foreground="White"
                                                        BorderThickness="0"
                                                        Command="{Binding DataContext.DeleteTransactionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                        CommandParameter="{Binding}" />
											</Border>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</StackPanel>
				</ScrollViewer>
			</Grid>
		</DockPanel>
	</Border>
</Window>